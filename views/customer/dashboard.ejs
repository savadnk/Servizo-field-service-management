

   <style>


    body{ background: var(--bg); color: var(--txt); }

    .dash-title{ color: var(--txt); }

    .stat-card{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
      height: 100%;
    }

    .stat-card h6{
      color: var(--text-300);
      font-size: 14px;
      margin-bottom: 6px;
      font-weight: 600;
      letter-spacing: .2px;
    }

    .stat-value{
      font-size: clamp(22px, 3.4vw, 28px);
      font-weight: 700;
      color: var(--txt);
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
    }

    .stat-sub{
      color: var(--grey);
      font-size: 12px;
      margin-top: 2px;
    }

    .value-green{ color: var(--green); }
    .value-blue{ color: var(--blue); }
    .value-amber{ color: var(--amber); }
    .value-cyan{ color: var(--cyan); }

  



    .list-group{
      --bs-list-group-bg: transparent;
      --bs-list-group-color: var(--txt);
      --bs-list-group-border-color: var(--line);
    }

    .list-group-item{
      background: var(--panel);
      color: var(--txt);
      border-color: var(--line);
    }

    .list-group-item + .list-group-item{
      border-top-color: var(--line);
    }

    .badge-green{
      background: rgba(34,197,94,.15);
      color: var(--green);
      border: 1px solid rgba(34,197,94,.35);
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 600;
    }

    .muted{ color: var(--muted); }

    /* Icon chips in cards */
    .card-icon{
      width: 36px; height: 36px; border-radius: 8px;
      display: inline-grid; place-items: center;
      background: var(--surface);
      border: 1px solid var(--line);
      color: var(--text-300);
    }

    /* Card grid spacing */
    .g-16{ --bs-gutter-x: 1rem; --bs-gutter-y: 1rem; }

    /* Focus styles for accessibility */
    a.btn:focus, button:focus, .list-group-item:focus{
      outline: 2px solid var(--focus) !important;
      outline-offset: 2px;
    }
    .panel{ background: var(--panel) !important; border: 1px solid var(--line) !important; border-radius: 12px !important; color: var(--txt); }
  .chart-wrap{ position: relative; height: 400px; }


  </style>

  <div class="container mt-4">
    <h2 class="dash-title mb-4">Customer Dashboard</h2>

    <div class="row g-16">
      <div class="col-md-4">
        <div class="stat-card text-start">
          <div class="d-flex align-items-center justify-content-between">
            <h6>Total Requests</h6>
            <span class="card-icon"><i class="ri-verified-badge-line"></i></span>
          </div>
          <div class="stat-value value-green"><%= totalRequests %></div>
          <div class="stat-sub">Last 30 days</div>
        </div>
      </div>

     
      <div class="col-md-4">
        <div class="stat-card text-start">
          <div class="d-flex align-items-center justify-content-between">
            <h6>Completed Jobs</h6>
            <span class="card-icon"><i class="ri-star-smile-line"></i></span>
          </div>
          <div class="stat-value value-amber"><%= completedJobs %></div>
          <div class="stat-sub">This month</div>
        </div>
      </div>

    

    
      <div class="col-md-4">
        <div class="stat-card text-start">
          <div class="d-flex align-items-center justify-content-between">
            <h6>Active Jobs</h6>
            <span class="card-icon"><i class="ri-briefcase-4-line"></i></span>
          </div>
          <div class="stat-value value-cyan"><%= activeJobs %></div>
          <div class="stat-sub">Currently in progress</div>
        </div>
      </div>

      
      <div class="col-md-4">
        <div class="stat-card text-start">
          <div class="d-flex align-items-center justify-content-between">
            <h6>Pending Payments</h6>
            <span class="card-icon"><i class="ri-currency-line"></i></span>
          </div>
          <div class="stat-value value-green">$<%= pendingPayments %></div>
          <div class="stat-sub">This month</div>
        </div>
      </div>
    </div>
  
  </div>

<div class="container my-5">
  <h3 class="fw-bold text-center mb-4">Customer Analytics</h3>
  <div class="row g-3">
    <!-- Job Status Summary -->
    <div class="col-md-6">
      <div class="card panel p-3">
        <h5 class="fw-bold text-center mb-2">Job Status Summary</h5>
        <div class="chart-wrap"><canvas id="jobSummaryChart"></canvas></div>
      </div>
    </div>
    <!-- Monthly Spending Trend -->
    <div class="col-md-6">
      <div class="card panel p-3">
        <h5 class="fw-bold text-center mb-2">Monthly Spending Trend</h5>
        <div class="chart-wrap"><canvas id="spendingChart"></canvas></div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Shared dark options
  const darkLegend = { labels: { color: '#9aa3b2', boxWidth: 10, boxHeight: 10 }, position: 'bottom' };
  const darkTooltip = { backgroundColor: '#151821', titleColor: '#e8ecf4', bodyColor: '#e8ecf4', borderColor: '#232735', borderWidth: 1 };
  const darkScales = {
    x: { grid: { color: 'rgba(35,39,53,0.6)' }, ticks: { color: '#9aa3b2' } },
    y: { grid: { color: 'rgba(35,39,53,0.6)' }, ticks: { color: '#9aa3b2', beginAtZero: true } }
  };

 const jobSummary = <%- JSON.stringify(jobSummary) %>;

  new Chart(document.getElementById('jobSummaryChart'), {
    type: 'pie',
    data: {
      labels: jobSummary.map(j => j._id),
      datasets: [{
        data: jobSummary.map(j => j.count),
        backgroundColor: ['#3b82f6','#f59e0b','#22d3ee','#22c55e','#ef4444'],
        borderColor: '#151821',
        borderWidth: 2
      }]
    },
 options: {
  responsive: true,
  maintainAspectRatio: false,
  layout: { padding: 10 },
  plugins: {
    legend: {
      position: 'bottom',
      labels: { color: '#9aa3b2', boxWidth: 12, boxHeight: 12 }
    },
    tooltip: darkTooltip
  },
  // Bigger radius (auto-calculated if undefined)
  elements: {
    arc: { borderWidth: 2 }
  }
}

  });

  // Line: Monthly Spending Trend
  const spendingTrend = <%- JSON.stringify(spendingTrend) %>;
  const spendLabels = spendingTrend.map(s => {
    const m = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    return m[s._id.month - 1] + ' ' + s._id.year;
  });
  const spendTotals = spendingTrend.map(s => s.total);

  new Chart(document.getElementById('spendingChart'), {
    type: 'line',
    data: {
      labels: spendLabels,
      datasets: [{
        label: 'Total Spending (â‚¹)',
        data: spendTotals,
        borderColor: '#22d3ee',                 // cyan token
        backgroundColor: 'rgba(34,211,238,0.15)',
        pointBackgroundColor: '#e8ecf4',
        pointBorderColor: '#22d3ee',
        pointRadius: 3,
        pointHoverRadius: 4,
        borderWidth: 2,
        tension: 0.35,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: darkLegend, tooltip: darkTooltip },
      scales: darkScales,
      layout: { padding: 8 }
    }
  });
</script>
