<style>
    body {
        background: var(--bg);
    }

    .jobs-title {
        color: var(--txt);
    }

    /* Card grid */
    .job-card {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        height: 100%;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
    }

    .job-title {
        color: var(--txt);
        font-weight: 700;
        font-size: 16px;
    }

    .job-meta {
        color: var(--muted);
        font-size: 13px;
    }

    .job-meta i {
        color: var(--text-300);
    }

    /* Status badges (chips) */
    .status-chip {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid var(--line);
        color: var(--text-300);
        background: var(--row);
    }

    .status-assigned {
        background: rgba(156, 163, 175, .15);
        color: var(--text-300);
        border-color: rgba(156, 163, 175, .35);
    }

    .status-accepted {
        background: rgba(59, 130, 246, .15);
        color: var(--blue);
        border-color: rgba(59, 130, 246, .35);
    }

    .status-progress {
        background: rgba(34, 211, 238, .15);
        color: var(--cyan);
        border-color: rgba(34, 211, 238, .35);
    }

    .status-paused {
        background: rgba(245, 158, 11, .15);
        color: var(--amber);
        border-color: rgba(245, 158, 11, .35);
    }

    .status-completed {
        background: rgba(34, 197, 94, .15);
        color: var(--green);
        border-color: rgba(34, 197, 94, .35);
    }

    /* Card actions */
    .btn-ghost {
        background: var(--surface);
        border: 1px solid var(--line);
        color: var(--txt);
    }

    .btn-ghost:hover {
        background: #1b1f26;
    }

    .status-select {
        background: var(--row);
        color: var(--txt);
        border: 1px solid var(--line);
    }

    /* Modal styling (detail sheet) */
    .modal-content {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 12px;
    }

    .modal-header {
        background: var(--row);
        color: var(--txt);
        border-bottom: 1px solid var(--line);
    }

    .modal-body {
        color: var(--txt);
    }

    .modal-body .muted {
        color: var(--muted);
    }

    .btn-close.btn-close-white {
        filter: invert(1);
    }

    .btn-secondary {
        background: var(--surface);
        border: 1px solid var(--line);
        color: var(--txt);
    }

    .btn-secondary:hover {
        background: #1b1f26;
    }

    /* Modal action bar */
    .action-bar .btn {
        border-radius: 8px;
        font-weight: 600;
    }

    .btn-accept {
        background: rgba(34, 197, 94, .18);
        color: var(--green);
        border: 1px solid rgba(34, 197, 94, .35);
    }

    .btn-accept:hover {
        background: rgba(34, 197, 94, .28);
    }

    .btn-progress {
        background: rgba(34, 211, 238, .18);
        color: var(--cyan);
        border: 1px solid rgba(34, 211, 238, .35);
    }

    .btn-progress:hover {
        background: rgba(34, 211, 238, .28);
    }

    .btn-pause {
        background: rgba(245, 158, 11, .18);
        color: var(--amber);
        border: 1px solid rgba(245, 158, 11, .35);
    }

    .btn-pause:hover {
        background: rgba(245, 158, 11, .28);
    }

    .btn-complete {
        background: rgba(34, 197, 94, .18);
        color: var(--green);
        border: 1px solid rgba(34, 197, 94, .35);
        opacity: .7;
    }

    .btn-complete.enabled {
        opacity: 1;
    }

    /* Grid spacing */
    .g-16 {
        --bs-gutter-x: 1rem;
        --bs-gutter-y: 1rem;
    }
</style>

<div class="container my-4">
    <h2 class="jobs-title mb-4">My Jobs</h2>

     <form method="get" action="/customer/jobs" class="mb-3">
    <!-- Status filter -->
    <select name="status"
      class="form-select form-select bg-black text-light rounded-pill border-1 border-dark px-4 py-2 fs-6 w-auto"
      onchange="this.form.submit()">
      <option value="">All Status</option>
      <option value="Pending" <%=selectedStatus==="Pending" ? "selected" : "" %>>Pending</option>
      <option value="Assigned" <%=selectedStatus==="Assigned" ? "selected" : "" %>>Assigned</option>
      <option value="Accepted" <%=selectedStatus==="Accepted" ? "selected" : "" %>>Accepted</option>
      <option value="Paused" <%=selectedStatus==="Paused" ? "selected" : "" %>>Paused</option>
      <option value="Completed" <%=selectedStatus==="Completed" ? "selected" : "" %>>Completed</option>
    </select>
  </form>

    <% if (jobs && jobs.length> 0) { %>
        <div class="row g-16">
            <% jobs.forEach(job=> {
                const st = job.status;
                const badgeClass =
                st==='Completed' ? 'status-completed' :
                st==='Accepted' ? 'status-accepted' :
                st==='Paused' ? 'status-paused' : 'status-assigned';
                %>
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="job-card d-flex flex-column justify-content-between">
                        <div>
                            <div class="d-flex align-items-start justify-content-between">
                                <h4 class="job-title m-0">
                                    <%= job.serviceType %>
                                </h4>

                            </div>

                            <div class="job-meta mt-2">

                                <div class="d-flex align-items-center gap-2 py-1">
                                    <p style="color: var(--txt);">
                                        <%= job.description.substring(0, 60) %>...
                                    </p>
                                </div>
                                <div class="d-flex align-items-center gap-2 ">
                                    <i class="ri-calendar-line" style="color: var(--green);"></i>
                                    <span style="color: var(--txt);">
                                        <%= job.deadline.toDateString() %>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <button class="btn btn-sm btn-ghost  " data-bs-toggle="modal"
                                data-bs-target="#jobModal-<%= job._id %>" style="background-color: var(--brand-600);">
                                View Details
                            </button>
                            <span class="status-chip <%= badgeClass %>">
                                <%= job.status %>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Modal: Detailed job sheet -->
                <div class="modal fade" id="jobModal-<%= job._id %>" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <div class="w-100 ">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="modal-title">
                                            <i class="ri-briefcase-4-line me-2"></i>
                                            <%= job.serviceType %>
                                        </h5>

                                    </div>
                                    <div class="mt-1" style="color: var(--muted); font-size: 12px;">
                                        <i class="ri-user-line me-1"></i>
                                        <%= job.admin?.companyName || 'Unknown' %>
                                            <span class="ms-3 " style="color: var(--muted);"><i
                                                    class="ri-phone-line me-1 "></i>
                                                <%= job.admin?.phone || 'N/A' %>
                                            </span>
                                    </div>
                                </div>
                                <button type="button" class="btn-close btn-close-white ms-3"
                                    data-bs-dismiss="modal"></button>
                            </div>

                            <div class="modal-body">
                                <h6 class="mb-2">Job Description</h6>
                                <p class="muted">
                                    <%= job.description || 'No description provided.' %>
                                </p>

                                <h6 class="mt-4 mb-2">Location</h6>
                                <p class="muted">
                                    <i class="ri-building-2-line me-1"></i>
                                    <%= job.address?.street %>, <%= job.address?.city %>,
                                            <%= job.address?.state %> - <%= job.address?.pincode %>
                                </p>

<h6 class="mt-4 mb-2">Worker Details</h6>
<% const jobAssignment = assignmentMap[job._id.toString()]; %>
<% if (jobAssignment && jobAssignment.worker) { %>
  <div class="d-flex align-items-center gap-3">
    <img src="<%= jobAssignment.worker.profilePhoto || '/images/avatar.png' %>"
         alt="worker photo" class="rounded-circle border" width="60" height="60">
    <div>
      <strong><%= jobAssignment.worker.name %></strong><br>
      <small>Email: <%= jobAssignment.worker.email %></small><br>
      <small>Phone: <%= jobAssignment.worker.phone %></small><br>
      <small>Skills: <%= jobAssignment.worker.skills?.join(", ") || "N/A" %></small>
    </div>
  </div>
<% } else { %>
  <p class="text-muted">⏳ No worker assigned yet</p>
<% } %>

<hr style="border-color: var(--muted);">

<!-- Timeline -->
<div class="mt-3">
  <h5>Job Timeline</h5>
  <% if (jobAssignment) { %>
    <ul>
      <li><strong>Assigned:</strong> <%= new Date(jobAssignment.assignedAt).toLocaleString() %></li>
      <% if (jobAssignment.updatedAt) { %>
        <li><strong>Last Updated:</strong> <%= new Date(jobAssignment.updatedAt).toLocaleString() %></li>
      <% } %>
      <% if (jobAssignment.completedAt) { %>
        <li><strong>Completed:</strong> <%= new Date(jobAssignment.completedAt).toLocaleString() %></li>
      <% } %>
    </ul>
  <% } else { %>
    <p class="text-muted">Timeline not available yet</p>
  <% } %>
</div>



                            </div>


                        </div>
                    </div>
                </div>
                <% }) %>
        </div>
        <% } else { %>
            <div class="text-center text-secondary py-4">No jobs requested yet</div>
            <% } %>
</div>