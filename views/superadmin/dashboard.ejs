<!-- Cardscard-text  -->
<style>
  .card {
    background-color: #151821;
  }
</style>

<div class="container mb-4">
  <h2 class="py-4">Analytics Overview</h2>
  <div class="row g-4">

    <!-- Row 1: 3 cards -->
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card card-text text-white  p-3 shadow-sm h-100" style="border-radius: 12px ; ">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Total Admins</h5>
          <i class="ri-file-list-3-line  fs-4"></i>
        </div>
        <h2 class="mt-3 fw-bold ">
          <%= stats.totalAdmins %>
        </h2>
      </div>
    </div>

    <div class="col-12 col-md-6 col-lg-4">
      <div class="card card-text text-white p-3 shadow-sm h-100" style="border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Total Workers</h5>
          <i class="ri-briefcase-line  fs-4"></i>
        </div>
        <h2 class="mt-3 fw-bold ">
          <%= stats.totalWorkers %>
        </h2>
      </div>
    </div>

    <div class="col-12 col-md-6 col-lg-4">
      <div class="card card-text text-white  p-3 shadow-sm h-100" style="border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Total Customers</h5>
          <i class="ri-user-settings-line  fs-4"></i>
        </div>
        <h2 class="mt-3 fw-bold ">
          <%= stats.totalCustomers %>
        </h2>
      </div>
    </div>



    <div class="col-12 col-md-6 col-lg-4">
      <div class="card card-text text-white  p-3 shadow-sm h-100" style="border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Total Jobs</h5>
          <i class="ri-time-line  fs-4"></i>
        </div>
        <h2 class="mt-3 fw-bold ">
          <%= stats.totalJobs %>
        </h2>
      </div>
    </div>

    <!-- Row 3: 2 cardscard-text  -->
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card card-text text-white  p-3 shadow-sm h-100" style="border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Jobs Status</h5>
          <i class="ri-checkbox-circle-line  fs-4"></i>
        </div>
        <div class="row mt-2">
          <!-- Left Column -->
          <div class="col-6">
            <ul class="list-unstyled mb-0">
              <li class="d-flex justify-content-between  pt-2">
                <span>Pending</span>
                <span class="fw-bold">
                  <%= stats.jobsByStatus['Pending'] || 0 %>
                </span>
              </li>
              <li class="d-flex justify-content-between  pt-2">
                <span>Assigned</span>
                <span class="fw-bold">
                  <%= stats.jobsByStatus['Assigned'] || 0 %>
                </span>
              </li>
              <li class="d-flex justify-content-between  pt-2">
                <span>In Progress</span>
                <span class="fw-bold">
                  <%= stats.jobsByStatus['In Progress'] || 0 %>
                </span>
              </li>
            </ul>
          </div>

          <!-- Right Column -->
          <div class="col-6">
            <ul class="list-unstyled mb-0">
              <li class="d-flex justify-content-between  pt-2">
                <span>Completed</span>
                <span class="fw-bold ">
                  <%= stats.jobsByStatus['Completed'] || 0 %>
                </span>
              </li>
              <li class="d-flex justify-content-between  pt-2">
                <span>Cancelled</span>
                <span class="fw-bold ">
                  <%= stats.jobsByStatus['Cancelled'] || 0 %>
                </span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 col-lg-4">
      <div class="card card-text text-white  p-3 shadow-sm h-100" style="border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Total Revenue</h5>
          <i class="ri-close-circle-line  fs-4"></i>
        </div>
        <h2 class="mt-3 fw-bold ">
          <%= stats.totalRevenue %>
        </h2>
      </div>
    </div>

  </div>
</div>

<div class="container mt-5">
  <h3 class="fw-bold text-center mb-4">Super Admin Analytics</h3>

  <div class="row">
    <!-- ===== Chart 1: Monthly Revenue Trend ===== -->
    <div class="col-md-6 mb-4">
      <div class="card p-3 shadow-sm">
        <h5 class="fw-bold text-center mb-3 text-light">Monthly Revenue Trend</h5>
        <canvas id="revenueChart" height="300"></canvas>
      </div>
    </div>

    <!-- ===== Chart 2: User Growth Trend ===== -->
    <div class="col-md-6 mb-4">
      <div class="card p-3 shadow-sm">
        <h5 class="fw-bold text-center mb-3 text-light">User Growth Overview</h5>
        <canvas id="userGrowthChart" height="300"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- ===== Chart 3: Top Performing Agencies & Workers ===== -->
<div class="card p-3 shadow-sm my-4">
  <h5 class="fw-bold text-center mb-3 text-light">Top Performing Agencies & Workers</h5>
  <div class="row">
    <div class="col-md-6">
      <h6 class="text-center mb-2 text-light">Top Agencies by Revenue</h6>
      <canvas id="topAgenciesChart" height="220"></canvas>
    </div>
    <div class="col-md-6">
      <h6 class="text-center mb-2 text-light">Top Workers by Earnings</h6>
      <canvas id="topWorkersChart" height="220"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // ===== Monthly Revenue Trend =====
  const revenueTrend = <%- JSON.stringify(revenueTrend) %>;
  const revLabels = revenueTrend.map(r => {
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    return months[r._id.month - 1] + " " + r._id.year;
  });
  const revData = revenueTrend.map(r => r.total);

  new Chart(document.getElementById("revenueChart"), {
    type: "line",
    data: {
      labels: revLabels,
      datasets: [{
        label: "Total Revenue (₹)",
        data: revData,
        borderColor: "rgba(54,162,235,1)",
        backgroundColor: "rgba(54,162,235,0.2)",
        fill: true,
        tension: 0.3,
      }],
    },
    options: {
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { display: true } },
    },
  });

  // ===== User Growth Overview =====
  const userGrowth = <%- JSON.stringify(userGrowth) %>;
  const grouped = {};

  // Group by role
  userGrowth.forEach(u => {
    const label = `${u._id.month}-${u._id.year}`;
    if (!grouped[label]) grouped[label] = { Admin: 0, Worker: 0, Customer: 0 };
    if (u._id.role === "admin") grouped[label].Admin += u.count;
    if (u._id.role === "worker") grouped[label].Worker += u.count;
    if (u._id.role === "customer") grouped[label].Customer += u.count;
  });

  const labels = Object.keys(grouped);
  const adminData = labels.map(l => grouped[l].Admin);
  const workerData = labels.map(l => grouped[l].Worker);
  const customerData = labels.map(l => grouped[l].Customer);

  new Chart(document.getElementById("userGrowthChart"), {
    type: "bar",
    data: {
      labels,
      datasets: [
        { label: "Admins", data: adminData, backgroundColor: "#36A2EB" },
        { label: "Workers", data: workerData, backgroundColor: "#FFCE56" },
        { label: "Customers", data: customerData, backgroundColor: "#16da64" },
      ],
    },
    options: {
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { position: "bottom" } },
    },
  });

   const topAgencies = <%- JSON.stringify(topAgencies) %>;
  const topWorkers = <%- JSON.stringify(topWorkers) %>;

  // ===== Top Agencies Chart =====
  new Chart(document.getElementById("topAgenciesChart"), {
    type: "bar",
    data: {
      labels: topAgencies.map(a => a.name || "Unknown"),
      datasets: [{
        label: "Revenue (₹)",
        data: topAgencies.map(a => a.totalRevenue),
        backgroundColor: "rgba(54, 162, 235, 0.6)",
        borderColor: "rgba(54, 162, 235, 1)",
        borderWidth: 1,
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } },
    }
  });

  // ===== Top Workers Chart =====
  new Chart(document.getElementById("topWorkersChart"), {
    type: "bar",
    data: {
      labels: topWorkers.map(w => w.name || "Unknown"),
      datasets: [{
        label: "Earnings (₹)",
        data: topWorkers.map(w => w.revenue),
        backgroundColor: "rgba(255, 159, 64, 0.6) ",
        borderColor: "rgba(255, 159, 64, 1)",
        borderWidth: 1,
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } },
    }
  });
</script>


<style>


  .card h2,
  p,
  i, span {
    color: #16da64;
  }

</style>

